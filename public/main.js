var app_ang=angular.module("todoApp",["ngResource","ngRoute","ngAnimate"]);app_ang.run(function(){console.log("app is runing")}),app_ang.config(["$routeProvider",function(a){a.when("/",{controller:"TodoListCtrl as list",templateUrl:"TodoList.html"}).otherwise({redirectTo:"/"})}]),app_ang.factory("Todo",["$resource",function(a){return a("/api/todo/:id",{id:"@id"},{update:{method:"PUT"}})}]),app_ang.controller("TodoListCtrl",["$timeout","Todo",function(a,b){var c=this;c.placeholderClassName="",c.justDeleted=!1,c.filterState=!1,c.nav={onGoing:{class:"active"},complete:{class:""},all:{class:""}},c.state=-1,c.error="",c.editedTodo=null,c.newTodoField="",c.addTodo=function(){var a={title:c.newTodoField.trim(),isComplete:!1};a.title&&b.save(a).$promise.then(function(a){c.newTodoField="",c.refresh()}).catch(function(a){c.handleError(a,"create item")})},c.deleteTodo=function(a){b.delete({id:a.id}).$promise.then(function(a){c.justDeleted=!0,c.refresh()}).catch(function(a){c.handleError(a,"delete item(s)")})},c.deleteComplete=function(){b.delete({id:"complete"}).$promise.then(function(a){c.justDeleted=!0,c.refresh()}).catch(function(a){c.handleError(a,"delete item(s)")})},c.doneTodo=function(a){b.update({id:a.id},{isComplete:!0}),c.refresh()},c.updateTodo=function(a,b){c.editedTodo=b,c.originalTodo=angular.extend({},b),setTimeout(function(){a.target.parentNode.getElementsByClassName("edit")[0].focus()},200)},c.updateDB=function(a){b.update({id:a.id},{title:a.title}),c.refresh()},c.handleError=function(a,b){a&&(c.error="Failed to "+b+". Server returned "+a.status+" - "+a.statusText)},c.getTab=function(a){var b={complete:{filterS:!0,complete:"active",onGoing:"",all:""},onGoing:{filterS:!1,complete:"",onGoing:"active",all:""},all:{filterS:"",complete:"",onGoing:"",all:"active"}};c.filterState=b[a].filterS,c.nav.complete.class=b[a].complete,c.nav.onGoing.class=b[a].onGoing,c.nav.all.class=b[a].all},c.refreshCounts=function(){c.nav.all.size=c.todos.length,c.nav.complete.size=c.todos.filter(function(a){return a.isComplete}).length,c.nav.onGoing.size=c.nav.all.size-c.nav.complete.size},c.refresh=function(){b.query(function(a){c.todos=a,c.refreshCounts()}).$promise.then(function(a){c.placeholderClassName="hidden"}).catch(function(a){c.handleError(a,"get list")})},c.hideUndoSpan=function(){c.justDeleted=!1},c.undoDelete=function(){b.update({id:"undo"},function(){c.hideUndoSpan(),c.refresh()})},c.refresh(),function d(){b.get({id:"state"}).$promise.then(function(a){a.state!==c.state&&(c.state=a.state,c.refresh()),"offline..."===c.error&&(c.error="")}).catch(function(a){c.error="offline..."}),a(d,1e3)}()}]);