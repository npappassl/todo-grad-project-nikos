var app_ang=angular.module("todoApp",["ngResource","ngRoute","ngAnimate"]);angular.module("todoApp").run(function(){console.log("app is runing")}),angular.module("todoApp").config(["$routeProvider",function(a){a.when("/",{controller:"mainCtrl as main",templateUrl:"TodoList.html"}).otherwise({redirectTo:"/"})}]),angular.module("todoApp").directive("nipaComplBut",["pollService","Todo",function(a,b){return{restrict:"E",scope:{todo:"=",index:"="},template:'<button id=compl{{index}} class="complButton">âœ“</button>',link:function(c,d,e,f){d.on("click",function(){b.update({id:c.todo.id},{isComplete:!0}).$promise.then(function(b){a.refresh()}).catch(function(b){a.handleError(b,"update item")})})},controller:function(){console.log("nipaUpdateBut")}}}]),angular.module("todoApp").directive("nipaDelBut",["pollService","Todo",function(a,b){return{restrict:"E",scope:{todo:"=",index:"=",display:"="},transclude:!1,template:'<button id=del{{index}} class="delButton">{{dis}}</button>',link:function(c,d,e,f){d.id="del"+c.$index,console.log(c.display),c.dis=c.display,d.on("click",function(){console.log("clicked",f,c),b.delete({id:c.todo.id}).$promise.then(function(b){console.log("deleted",b),a.refresh(),a.showUndoSpan()}).catch(function(b){a.handleError(b,"delete item(s)")})})},controller:function(){console.log("nipaDelBut")}}}]),angular.module("todoApp").factory("Todo",["$resource",function(a){return a("/api/todo/:id",{id:"@id"},{update:{method:"PUT"}})}]),angular.module("todoApp").service("pollService",["$timeout","Todo",function(a,b){console.log("pollService","init");var c=this;c.stateId=-1,c.refreshes={},c.filterState={value:!1},c.justDeleted={value:!1},c.errorDiv={text:""},c.handleError=function(a,b){a&&(c.errorDiv.text="Failed to "+b+". Server returned "+a.status+" - "+a.statusText),c.refresh("TodoListCtrl")},c.tick=function(d){b.get({id:"state"}).$promise.then(function(a){a.state!==c.stateId&&(c.stateId=a.state,c.refresh())}).catch(function(a){console.log(a,"offline")}),a(function(){c.tick(error,d)},1e3)},c.setUndo=function(a){c.justDeleted=a},c.showUndoSpan=function(){c.justDeleted.value=!0},c.hideUndoSpan=function(){c.justDeleted.value=!1},c.getError=function(){return c.errorDiv},c.getFilter=function(){return c.filterState},c.setRefresh=function(a,b){c.refreshes[a]=function(){b()}},c.refresh=function(a){console.log("name",a),a?c.refreshes[a]():(c.refreshes.navCtrl(),c.refreshes.TodoListCtrl())}}]),angular.module("todoApp").controller("TodoListCtrl",["pollService","Todo",function(a,b){console.log("TodoListCtrl","init");var c=this;c.nav={onGoing:{class:"active"},complete:{class:""},all:{class:""}},c.state={placeholderClassName:"",justDeleted:!1,error:{text:""}},c.editedTodo=null,c.updateTodo=function(a,b){c.editedTodo=b,c.originalTodo=angular.extend({},b),setTimeout(function(){a.target.parentNode.getElementsByClassName("edit")[0].focus()},200)},c.updateDB=function(a){b.update({id:a.id},{title:a.title}),c.refresh()},c.refresh=function(){console.log("refreshList"),b.query(function(a){c.todos=a}).$promise.then(function(a){c.state.placeholderClassName="hidden"}).catch(function(b){a.handleError(b,"get list")})},c.hideUndoSpan=function(){c.state.justDeleted=!1},a.setRefresh("TodoListCtrl",c.refresh),c.state.filterState=a.getFilter(),c.state.error=a.getError(),c.refresh(),a.tick("TodoListCtrl")}]),angular.module("todoApp").controller("mainCtrl",["$timeout","Todo",function(a,b){console.log("mainCtrl","init")}]),angular.module("todoApp").controller("navCtrl",["pollService","Todo",function(a,b){console.log("navCtrl","init");var c=this;c.nav={onGoing:{class:"active"},complete:{class:""},all:{class:""}},c.justDeleted=!1,c.refresh=function(){b.query().$promise.then(function(a){c.nav.all.size=a.length,c.nav.complete.size=a.filter(function(a){return a.isComplete}).length,c.nav.onGoing.size=c.nav.all.size-c.nav.complete.size,console.log(a)})},c.getTab=function(b){var d={complete:{filterS:!0,complete:"active",onGoing:"",all:""},onGoing:{filterS:!1,complete:"",onGoing:"active",all:""},all:{filterS:"",complete:"",onGoing:"",all:"active"}};c.nav.complete.class=d[b].complete,c.nav.onGoing.class=d[b].onGoing,c.nav.all.class=d[b].all,c.filterState.value=d[b].filterS,a.refresh()},c.filterState=a.getFilter(),a.setRefresh("navCtrl",c.refresh),c.refresh()}]),angular.module("todoApp").controller("newPostCtrl",["pollService","Todo",function(a,b){var c=this;c.newTodoField="",c.addTodo=function(){var d={title:c.newTodoField.trim(),isComplete:!1};d.title&&b.save(d).$promise.then(function(b){c.newTodoField="",a.refresh()}).catch(function(b){a.handleError(b,"create item")})}}]),angular.module("todoApp").controller("undoCtrl",["pollService","Todo",function(a,b){console.log("undoCtrl","init");var c=this;c.justDeleted={value:!1},a.setUndo(c.justDeleted),c.hideUndoSpan=function(){a.hideUndoSpan(),a.refresh()},c.undoDelete=function(){a.hideUndoSpan(),b.update({id:"undo"},function(b){a.refresh()}).$promise.catch(function(b){a.handleError(b,"undo")})}}]);